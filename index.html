<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Map Example</title>
    <link rel="shortcut icon" href="#">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@2.0.0-alpha/dist/leaflet.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        #map {
            height: 100vh;
            width: 100%;
        }
        #locate-button {
            margin: 10px;
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #locate-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
<div id="map"></div>
<script type="importmap">
    {
        "imports": {
            "leaflet": "https://unpkg.com/leaflet@2.0.0-alpha.1/dist/leaflet.js"
        }
    }
</script>
<script type="module">
    import L, {Map, TileLayer, Marker, LatLng, LatLngBounds, Popup} from 'leaflet';

    // Initialize the map with a specific view
    const initialLat = -20.575581867678267; // Latitude for the center of the view
    const initialLon = 57.89588928222657;  // Longitude for the center of the view
    const initialZoom = 11;

    // Define the bounds using the provided coordinates
    const southWest = new LatLng(-20.575581867678267, 57.23327636718751);
    const northEast = new LatLng(-19.95656892635273, 57.919235229492195);
    const bounds = new LatLngBounds(southWest, northEast);

    // Initialize the map
    const map = new Map('map').setView([initialLat, initialLon], initialZoom); // Default view
    console.log(map);
    map.fitBounds(bounds);
    map.setMaxBounds(bounds);

    // Add OpenStreetMap tile layer
    const tiles = new TileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        minZoom: 11,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    function showError(error) {
        switch(error.code) {
            case error.PERMISSION_DENIED:
                alert("User denied the request for Geolocation.");
                break;
            case error.POSITION_UNAVAILABLE:
                alert("Location information is unavailable.");
                break;
            case error.TIMEOUT:
                alert("The request to get user location timed out.");
                break;
            case error.UNKNOWN_ERROR:
                alert("An unknown error occurred.");
                break;
        }
    }

    // Function to load pharmacies from JSON
    async function loadPharmacies() {
        try {
            const response = await fetch('./data/mu_pharmacies.json');
            const pharmacies = await response.json();

            pharmacies.forEach(pharmacy => {
                const { Name_of_Pharmacy, Address, Contact_Number, Latitude, Longitude } = pharmacy;

                // Create a marker for each pharmacy
                // const marker = L.marker([Latitude, Longitude]).addTo(map)
                
                var popupContent = `<strong>${Name_of_Pharmacy}</strong><br>${Address}<br><br>ðŸ“ž ${Contact_Number}`;

                var popup = new Popup({
                    maxWidth: 500, // Maximum width of the popup
                    minWidth: 200, // Minimum width of the popup
                    maxHeight: 400 // Maximum height of the popup (for scrollable content)
                }).setContent(popupContent);
            });
        } catch (error) {
            console.error('Error loading pharmacies:', error);
        }
    }

    // Call the function to load pharmacies
    loadPharmacies();
</script>
</body>
</html>
